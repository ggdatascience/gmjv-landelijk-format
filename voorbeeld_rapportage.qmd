---
title: ""
author: ""
format:
  html:
    page-layout: full
    css: custom.css
    toc: TRUE
    embed-resources: true
params:
  gemeentecode: 1 
  is_pdf: false
editor: visual
format-links: false
---

\

```{r, echo=F, message=F, warning=F}
# Het script maakt gebruik van een aantal packages
# Deze moeten bij de eerste keer lokaal worden geinstalleerd
# Hieronder worden de benodige packages geladen
library(gt)
library(dplyr)
library(ggplot2)
library(tidyr)
library(haven)
library(stringr) # Voor str_replace
library(labelled) # Package om te werken met datalabels, o.a. voor to_character()
library(survey) # Package om te werken met gewogen gemiddelds incl. betrouwbaarheidsintervallen
library(glue) #om strings aangenaam aan elkaar te plakken

options(dplyr.summarise.inform = FALSE)
source("hulpfuncties.R")

#Standaardwaarden in te stellen door gebruiker:
# Standaard kleuren
default_kleuren_grafiek <- c("#012C17","#76B82A","#007E48")
default_kleuren_responstabel <- c("header" = "#012C17",
                                  "kleur_1" = "#007E48",
                                  "kleur_2" = "#76B82A",
                                  "kleur_tekst" = "#FFFFFF"
                                  )

# Standaard minima voor groep & cel
default_Nvar = 100 # Minimum aantal invullers per vraag.
default_Ncel = 10 # Minimum aantal invullers oper antwoordoptie.

# Standaard regio
# Pas onderstaande naam en code aan naar de naam en code van je eigen regio.
regionaam <- 'GGD Limburg-Noord'
regiocode <- 23

#SPSS data inlezen
# Regionaal bestand
file_path_regio = "nep testdata GMJV - Regionaal trendbestand 2022-2024.sav"

# Landelijk bestand
#file_path_land = "Totaalbestand_CGMJV2022_2024_GGD_versie 1 (N = xxx).sav"

#Lees SPSS bestand & converteer 'user-missing' naar missing in R (NA)
monitor_df = haven::read_spss(file_path_regio, user_na =T) %>%
  labelled::user_na_to_na()

#TODO verwijderen bij echte data. tijdelijk varlabel voor jaarvariabele
var_label(monitor_df$AGOJB401) <- "Jaar"
#monitor_df_land = haven::read_spss(file_path_land,user_na =T) %>%
#  labelled::user_na_to_na()

#Maak survey designs
# Regionaal 2022 en 2024
design_regio <- survey_design_maken(
                          strata = 'Stratum', 
                          gewichten = 'Standaardisatiefactor', 
                          data = monitor_df)

# Landelijk 2022 en 2024
#design_land <- survey_design_maken(
#                          strata = 'Stratum', 
#                          gewichten = 'Standaardisatiefactor', 
#                          data = monitor_df_land)

#Er is niet goed aangegeven wat missing is in SPSS.
#tijdelijke functie om 9 Onbekend te verwijderen & naar NA te zetten

for(var in names(monitor_df)){
  
  monitor_df <- monitor_df %>% verwijder_9_onbekend(var)

}

#TODO Tijdelijke filter op alleen gemeente in parameter
monitor_df_regio <- monitor_df
monitor_df <- monitor_df %>%
  filter(Gemeentecode == params$gemeentecode)

#Maak survey design gemeente
# Gemeente 2022 en 2024
design_gem <- survey_design_maken(
                          strata = 'Stratum', 
                          gewichten = 'Standaardisatiefactor', 
                          data = monitor_df)

# ALTERNATIEVE METHODE VAN INLADEN: regionale data invoegen in landelijk
# Landelijk bestand inladen
# df <- haven::read_spss(file.choose(), user_na =T) %>%
#   labelled::user_na_to_na()
# 
# # Regionaal bestand inladen
# df_regio <- haven::read_spss(file.choose(), user_na =T) %>%
#   labelled::user_na_to_na()
# 
# # Check of aantallen gelijk zijn.
# # NB. Alleen deelnemers met landelijke weegfactor zitten in landelijk bestand.
# if (sum(df_regio$Standaardisatiefactor != 0) != nrow(df %>% filter(GGDregio == regiocode))) {
#   print("Aantal deelnemers in regio is niet hetzelfde in beide bestanden, check data.")
# }
# 
#
# TODO zorgen dat hier ook nog op jaar gefilterd wordt!
# # Filter regio uit landelijk databestand
# df <- df %>%
#   filter(GGDregio != regiocode)
# 
# # Voeg regiobestand toe aan landelijk bestand
# df <- df %>%
#   full_join(df_regio)
# 
# # Opschonen
# rm(df_regio)
# 
# #Er is niet goed aangegeven wat missing is in SPSS.
# #tijdelijke functie om 9 Onbekend te verwijderen & naar NA te zetten
# 
# for(var in names(df)){
#   
#   df <- df %>% verwijder_9_onbekend(var)
# 
# }
# 
# # Regionale data filteren
# df %>%
#   filter(GGDregio == regiocode)
# 
# # Gemeentelijke data filteren
# df %>%
#   filter(Gemeentecode == params$gemeentecode)

```

\

```{r, echo=F}

if(params$is_pdf){
  
 render_toc(
   toc_header_name = "Inhoudsopgave",
   "voorbeeld_rapportage.qmd"
   )
}
```

::: voorblad_achtergrond
![](Voorbeeld%20voorblad.png)

::: voorblad_gemeentenaam
`r labelled_naar_character(monitor_df, "Gemeentecode") %>% unique()`
:::

::: voorblad_datum
`r Sys.Date()`
:::
:::

# Over de Gezondheidsmonitor Jongvolwassenen

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
In totaal hebben `r nrow(monitor_df)` jongvolwassenen uit Nederland de vragenlijst ingevuld. Van deze respondenten komen `r nrow(monitor_df_regio)` jongvolwassenen uit `r labelled_naar_character(monitor_df_regio, "GGDregio") %>% unique()`.
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Leeswijzer en achtergrond

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Achtergrondkenmerken

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
Van de respondenten is `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGGSA401', value = 2)` vrouw en `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGGSA401', value = 1)` man. Daarnaast geeft `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGGSA401', value = 3)` aan zich anders dan man of vrouw te voelen. 

:::

::: column
Van de respondenten is `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGLFA401', value = 1)` 16 of 17 jaar, `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGLFA401', value = 2)` tussen de 18 en 20 jaar en `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGLFA401', value = 3)` tussen de 21 en 25 jaar.

<br>

`r #monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'AGETS411', value = 1)` heeft een Nederlandse herkomst.
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}
plot = monitor_df %>% 
  maak_staafdiagram_meerdere_staven(
    var_inhoud = "AGOWS402",
    titel = "Opleidingsniveau"
  )

plot

```
:::

::: column
DONUTS INVOEGEN TODO
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}
plot = maak_staafdiagram_gestapeld(
  data = monitor_df, 
  var_inhoud = 'AGLFA401', 
  titel = "Leeftijd"
)

plot
```
:::

::: column
:::
:::

# Woon- en werksituatie en financiën

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
De woon-, werk- en financiële situatie van jongvolwassenen kan veel invloed hebben op het welzijn en de mentale en fysieke gezondheid van jongvolwassenen. In een tijd waarin er sprake is van een woning- en financiële crisis is het van belang om inzichtelijk te hebben in welke situaties de jongvolwassenen zitten.

<br> 

**Woonsituatie**

De meeste respondenten wonen `r #monitor_df %>% maak_top(survey_design = design_gem,             variabelen = 'AGHHA403', value = 1:8, top = 1)`. `r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'AGHHA403', variabele_label = 'in deze woonsituatie woont', vergelijking = 'AGOJB401')` TODO NOG CONDITIONEEL MAKEN OP VORIG ANWTOORD OID.
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}
# plot = monitor_df %>% 
#   maak_staafdiagram_vergelijking(
#     var_inhoud = "AGOWA401",
#     var_crossings = "AGLFA401",
#      titel = "Volgt een opleiding")
# plot
# 
# plot2 = monitor_df %>% 
#   maak_staafdiagram_vergelijking(
#     var_inhoud = "AGWSA401",
#     var_crossings = "AGLFA401",
#      titel = "Heeft betaald werk")
# plot2

# ALTERNATIEF in één grafiek:
# plot = monitor_df %>% 
#   maak_staafdiagram_meerdere_staven(
#     var_inhoud = c("AGOWA401", "AGWSA401"),
#     var_crossing = "AGLFA401",
#     titel = "Volgt een opleiding en heeft betaald werk"
#   )
# 
# plot

```
:::

::: column
**Werk- en financiële situatie**

De meeste werkende jongvolwassenen in uw gemeente werken `r #monitor_df %>% maak_top(survey_design = design_gem, variabelen = 'AGWSA413', value = 1:5, top = 1)`. `r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'AGWSA413', variabele_label = 'zoveel uren werkt', vergelijking = 'AGOJB401')` TODO NOG CONDITIONEEL MAKEN OP VORIG ANWTOORD OID. TODO zIN ERNA INVOEGEN

<br>
`r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = '', vergelijking = 'AGOJB401')` # TODO INDICATOR NOG TOEVOEGEN WANT DEZE BESTAAT NIET.
`r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'AGWSA412', vergelijking = 'AGOJB401')`
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}
# plot = monitor_df %>% 
#   maak_staafdiagram_meerdere_staven(
#     var_inhoud = "AGHHA403",
#     titel = "Woonsituatie")
# 
# plot

```
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}

# plot = monitor_df %>% 
#   maak_staafdiagram_meerdere_staven(
#     var_inhoud = c("AGWSA410", "AGWSA411", "AGWSA412", "AGWSA406"),
#     titel = "Werksituatie",
#     flip = T
#   )
# 
# plot

# plot = monitor_df %>% 
#   maak_staafdiagram_meerdere_staven(
#     var_inhoud = c("FIIKA401", "FIIKA402", "FIIKA403"),
#     titel = "Financiële situatie"
#   )
# 
# plot

```
:::

::: column
[Het Nibud](https://www.nibud.nl/) (Nationaal Instituut voor Budgetvoorlichting) geeft advies over onder andere rondkomen, sparen en geldproblemen.
:::
:::

# Gezondheid en geluk

::: {layout="[[30,30,30],[30,30,30]]"}
::: column

**Ervaren Gezondheid**

Uit de resultaten blijkt dat `r monitor_df %>% maak_percentage(survey_design = design_gem, variabele = "GZGGA402")` van de jongvolwassen in uw gemeente de eigen gezondheid als (zeer) goed ervaart. 
`r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'GZGGA402', variabele_label = "hun eigen gezondheid als (zeer) goed ervaart", vergelijking = 'AGOJB401')` 
:::

::: column
**Geluk**

Een andere belangrijke indicator voor het welzijn van jongvolwassenen is hoe gelukkig zij 
zich voelen. `r #monitor_df %>% maak_percentage(survey_design = design_gem, variabele = "LVPKA407")` van de jongvolwassenen in uw gemeente voelde zich in de afgelopen vier weken vaak tot voortdurend gelukkig.  `r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'LVPKA407', variabele_label = "hun eigen gezondheid als (zeer) goed ervaart", vergelijking = 'AGOJB401')` 
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}

# plot = monitor_df %>%
#   maak_staafdiagram_meerdere_staven(
#     var_inhoud = c("GZGGA402", "LVPKA407"),
#     var_crossing = "AGGSA401",
#     titel = "Ervaren gezondheid en geluk"
#   )
# 
# plot

```
:::

::: column
**Slaap**

`r #monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'GZSLA401') %>% bol_met_cijfer()`
`r #monitor_df %>% maak_percentage(survey_design = design_gem, variabele = 'GZSLA402') %>% bol_met_cijfer()`
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}

# plot = monitor_df %>% 
#   maak_staafdiagram_meerdere_staven(
#     var_inhoud = c("LVTEA402", "LVTEA404", "LVTEA406"),
#     titel = "Tevredenheid met jezelf, je lichaam en je leven"
#   )
# 
# plot

```
:::

::: column
`r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'LVTEA402', variabele_label = "(zeer) tevreden is met zichzelf", vergelijking = 'AGOJB401')` `r #monitor_df %>% maak_vergelijking(survey_design = design_gem, variabele = 'LVTEA402', variabele_label = "(zeer) tevreden is met zichzelf", vergelijking = 'AGGSA402')` 
:::
:::

# Mentaal welbevinden

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
**Stress**

Het hebben van stress (spanning of druk) kan zowel gezond als ongezond zijn. Gezonde stress kan ervoor zorgen dat je extra alert kunt reageren en geconcentreerd kunt werken. Deze spanning zal snel afnemen na de gebeurtenis. Wanneer stress te lang duurt (ongezonde stress), is er meer tijd nodig om te herstellen. Bij te veel stress is er te weinig tijd om tussendoor te herstellen en kan dit leiden tot spanningsklachten en een burn-out.
:::

::: column
Het percentage mannen dat zich (heel) vaak gestrest voelt is hoger dan/lager dan/gelijk onder vrouwen. Vrouwen ervaren de meeste stress van studie of school, de combinatie van alles wat zij moeten doen en de eisen die zij aan zichzelf stellen.

Het percentage dat zich (heel) vaak gestrest voelt is hoger onder de 21-25-jarigen dan onder de 16-17-jarigen. Jongvolwassenen in de leeftijd van 21 -- 25 jaar ervaren de meeste stress op het gebied van de combinatie van alles wat zij moeten doen, de eisen die zij aan zichzelf stellen, en studie of school.
:::

::: column
**Prestatiedruk**

Sommige jongvolwassenen voelen druk om aan verwachtingen te voldoen. Ze hebben vaak het gevoel dat ze iets goed of beter moeten doen. Bijvoorbeeld hoge cijfers halen, een goede baan hebben of voldoen aan het perfecte plaatje.

<br>

Meer jongvolwassenen ervaren prestatiedruk vanuit zichzelf dan vanuit anderen. Het percentage dat prestatiedruk ervaart vanuit zichzelf is hoger/lager onder de xx-xx-jarigen dan onder de 16-17-jarigen.
:::

::: column
```{r, echo = F, fig.alt= ggplot2::get_alt_text(plot), warning = F}

# Staafgrafiek met trend (zeer) vaak gestresst, regio vergeleken met landelijk

plot = monitor_df %>% 
   maak_staafdiagram_dubbele_uitsplitsing(
     var_inhoud = "LVSTA415", 
     var_crossing_groep = "AGOJB401",
     var_crossing_kleur = "AGGSA402", # gender nog wijzigen naar vergelijking met landelijk
     titel = "Voelt zich (heel) vaak gestrest")

plot

```
:::

::: column
Top 5 bronnen van stress:

-   `r maak_top(data = monitor_df, survey_design = design_gem, variabelen = c("LVVTA404", "LVVTA405", "LVVTA406", "LVVTA407", "LVVTA408", "LVVTA409", "LVVTA410"), top = 1)`
-   `r maak_top(data = monitor_df, survey_design = design_gem, variabelen = c("LVVTA404", "LVVTA405", "LVVTA406", "LVVTA407", "LVVTA408", "LVVTA409", "LVVTA410"), top = 2)`
-   `r maak_top(data = monitor_df, survey_design = design_gem, variabelen = c("LVVTA404", "LVVTA405", "LVVTA406", "LVVTA407", "LVVTA408", "LVVTA409", "LVVTA410"), top = 3)`
-   `r maak_top(data = monitor_df, survey_design = design_gem, variabelen = c("LVVTA404", "LVVTA405", "LVVTA406", "LVVTA407", "LVVTA408", "LVVTA409", "LVVTA410"), top = 4)`
-   `r maak_top(data = monitor_df, survey_design = design_gem, variabelen = c("LVVTA404", "LVVTA405", "LVVTA406", "LVVTA407", "LVVTA408", "LVVTA409", "LVVTA410"), top = 5)`
:::

::: column
```{r, echo = F, fig.alt=ggplot2::get_alt_text(plot), warning = F}

# Staafgrafiek prestatiedruk vanuit zichzelf, uitgesplitst naar gender

plot = monitor_df %>% maak_staafdiagram_vergelijking(
  var_inhoud = "LVEES404",
  var_crossings = "AGGSA402",
  titel = "Ervaart regelmatig tot vaak prestatiedruk vanuit zichzelf",
  #kleuren_grafiek = default_kleuren_grafiek,
)

plot

```
:::
:::

# Beschermende factoren en vertrouwen in de toekomst

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Bewegen en sporten

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Middelengebruik

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Jongvolwassenen en de coronaperiode

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Digitale leefomgeving

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# Seksualiteit

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::

# TITEL

::: {layout="[[30,30,30],[30,30,30]]"}
::: column
`r bol_met_cijfer(maak_percentage(data = monitor_df, survey_design = design_gem, variabele = 'LVPKS403'))`
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::

::: column
:::
:::
